$(document).ready(function(){function n(n,t){$.ajax({type:"POST",url:"/monitoreotest/cargas/EliminarCarga",data:JSON.stringify({CargaId:n,motivo:t}),dataType:"json",contentType:"application/json",success:function(n){n.success?location.reload():Mensajes.MostrarError(n.error)}})}var t=$("#tbl").dataTable({bProcessing:!0,bServerSide:!0,ajax:{url:"/monitoreotest/cargas/ObtenerListadoIndex",type:"POST"},bLengthChange:!0,bFilter:!0,bSort:!0,bInfo:!0,order:[[6,"desc"]],aoColumns:[{bSortable:!0,sWidth:"14%"},{bSortable:!0,sWidth:"14%"},{bSortable:!0,sWidth:"12%"},{bSortable:!0,sWidth:"24%"},{bSortable:!0,sWidth:"9%"},{bSortable:!0,sWidth:"17%"},{bSortable:!1,sWidth:"10%",mRender:function(n,t,i){var r="",u=i[7],f=i[8],e=i[9];return f?r+='<a class="btn btn-danger btn-xs btn-ver-elimino" id="'+n+'">Anulado (+info)<\/a>':u&&e&&(r+='<a class="btn btn-danger btn-xs btn-eliminar" id="'+n+'" '+(u?"puede":"")+">Anular<\/a>"),r}}]});$("#tbl").on("click",".btn-ver-elimino",function(n){var t=n.currentTarget.id;$.ajax({type:"POST",url:"/monitoreotest/cargas/ObtenerInfoAnulacion",data:JSON.stringify({cargaId:t}),dataType:"json",contentType:"application/json",success:function(n){var t="";t+="<b>ANULÓ:<\/b>&nbsp;"+n.anulo+"<br/>";t+="<b>FECHA HORA:<\/b>&nbsp;"+n.fechaHora+"<br/>";t+="<b>MOTIVO:<\/b>&nbsp;"+n.motivo+"<br/>";Mensajes.MostrarOK(t)}})});$("#tbl").on("click",".btn-eliminar",function(n){var t=n.currentTarget.id,i=$(this).is("[puede]");i?Mensajes.MostrarSiNo("¿Desea anular la carga?",function(){$("#EliminarCargaId").val(t);$("#MotivoModal").modal("show");$("#tbl").DataTable().ajax.url("/monitoreotest/cargas/ObtenerListadoIndex");$("#tbl").DataTable().ajax.reload()}):Mensajes.MostrarError("No puedes anular la carga porque ya se encuentra en auditoría.")});$("#btnMotivoContinuar").click(function(){var i=parseInt($("#EliminarCargaId").val()),t=$("#TextMotivo").val();if(t.length<=3){Mensajes.MostrarError("Debes ingresar un motivo.");return}n(i,t)})});